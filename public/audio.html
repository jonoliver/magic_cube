<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>The Cube</title>
  <link rel="stylesheet" href="index.css" />
</head>
<body class="audio">
  <div class="record"></div>
  <div class="result"></div>
  <script src="js/util.js"></script>
  <script type="text/javascript">
    let factor = 33.333333333333;
    function updateRecord({alpha, beta, gamma}){
      factor = gamma;
      // document.querySelector('.record-container').style.transform = `rotate(${gamma}deg)`
    }
    function updateFromMobileOrientation(data){
      updateRecord(data);
      // view.updateCube(data);
      if (sampler) { sampler.update(data) }
    }

    function updateFromMobileTap(){
      view.updateColorSelection();
    }
    // MOBILE ONLY
    // TODO: check for mobile device
    window.addEventListener('deviceorientation', (data) => {
      view.updateCube(data);
    });

    const constrainedRateFromValue = (input, inputLimits, outputLimits) => {
      const [inputLow, inputHigh] = inputLimits;
      const [outputLow, outputHigh] = outputLimits;
      const isPos = (input > 0);
      const value = constrain(input, inputLow, inputHigh);
      const inputLimit = isPos ? inputHigh : inputLow;
      const outputLimit = isPos ? outputHigh : outputLow;
      return value * outputLimit / inputLimit;// * (isPos ? 1 : -1);
    }

    let $record = document.querySelector('.record');
    let position = 0;
    let i = 0;
    function recurse(time=0){
      const { constrain } = window.Util;
      // const constrainedFactor = constrain(factor, -33.33, 33.33);
      // const constrainedFactor = constrain(factor, -33.33, 33.33);

      const value = constrain(factor, -12, 10);
      const [low, high] = [-33.33, 33.33]
      const isPos = (factor > 0);
      const limit = isPos ? high : low;
      const constrainedFactor = value * limit / 10 * (isPos ? 1 : -1);
      const speed = 60 / constrainedFactor / 360 * 1000
      let inc = ((time - i) / speed);
      i = time;
      position = position + inc;
      $record.style.transform = `rotate(${position}deg)`;
      window.requestAnimationFrame(recurse);
    }
    recurse();
  </script>
  <script src="$SOCKET_SERVER/socket.io/socket.io.js"></script>
  <script src="js/socket.js"></script>
  <script src="js/view.js"></script>
  <script src="js/sampler.js"></script>
</body>
</html>
