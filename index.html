<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <style>
      body {
        text-align: center;
        font-family: sans-serif;
        font-size: 5rem;
        font-weight: bold;
        color: #FFF;
        opacity: .65;
      }
      .square {
        height: 40px;
        width: 40px;
        background: #FFF;
        display: inline-block;
        margin: 1rem;
        opacity: .65;
      }
      .result {
        /*text-shadow: #000000 1px 1px 1px, #ffffff -1px -1px 1px;*/
      }
    </style>
  </head>
  <body>
  <div class="square square1"></div>
  <div class="square square2"></div>
  <div class="square square3"></div>
  <div class="result"></div>
  <script type="text/javascript">
    // window.addEventListener("deviceorientation", (e) => console.log(e), true);
    // window.ondevicemotionevent = (e) => console.log(e)
  </script>
  <script src="http://192.168.0.6:3000/socket.io/socket.io.js"></script>
  <script>
    let r,g,b;

    const socket = io('http://192.168.0.6:3000');
    console.log(socket);
    socket.on('connect', function(){  console.log('connected');});
    socket.on('disconnect', function(){});

    socket.on('update', function(data){
      // console.log(data);
      const { alpha, beta, gamma } = data;
      console.log(beta);
      r = Math.round(valueFromAlpha(Math.abs(alpha)));
      g = Math.round(valueFromBeta(Math.abs(beta)));
      b = Math.round(valueFromGamma(Math.abs(gamma)));
      // console.log(r,g,b);
      // console.log(g);
      // document.querySelector('body').style.background = `rgb(${r}, 0, 0)`;
      // document.querySelector('body').style.background = `rgb(0, ${g}, 0)`;
      // document.querySelector('body').style.background = `rgb(0, 0, ${b})`;
      document.querySelector('.square1').style.transform = `rotate(${alpha}deg)`;
      document.querySelector('.square2').style.transform = `rotate(${beta}deg)`;
      document.querySelector('.square3').style.transform = `rotate(${gamma}deg)`;
      document.querySelector('body').style.background = `rgb(${r}, ${g}, ${b})`;
    });

    socket.on('tap', function(data){
      document.querySelector('.result').innerText = `rgb(${r}, ${g}, ${b})`;
    });

    document.addEventListener('click', () => {
      const toHex = (num) => `0${num.toString(16)}`.slice(-2).toUpperCase();
      document.querySelector('.result').style.color = `rgb(${r}, ${g}, ${b})`;
      document.querySelector('.result').innerText = "#" + toHex(r) + toHex(g) + toHex(b);
      socket.emit('tap');
    });

    window.ondeviceorientation = (e) => {
      const { alpha, beta, gamma } = e;
      r = Math.floor(Math.abs(alpha));
      g = Math.floor(Math.abs(beta));
      b = Math.floor(Math.abs(gamma));
      document.querySelector('body').style.background = `rgb(${r}, ${g}, ${b})`;
      socket.emit('update', { alpha, beta, gamma });
    }
    const proportion = (a,b,c) => a*b/c;
    const valueFromBeta = (v) => proportion(v, 255, 180);
    const valueFromGamma = (v) => proportion(v, 255, 90);
    const valueFromAlpha = (v) => proportion(v, 255, 360);

  </script>
  </body>
</html>
